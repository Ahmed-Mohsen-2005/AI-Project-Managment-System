{% extends "base.html" %}

{% block title %}Settings - AIPMS{% endblock title %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">
{% endblock extra_css %}

{% block content %}
    <div class="settings-container card" data-user-id="{{ user_id }}">
        <h1 class="page-title">
            <i class="fas fa-cog"></i> {{ t.settings_title }}
        </h1>

        <!-- Search Bar -->
        <div style="margin-bottom: 20px;">
            <div class="search-bar-container">
                <i class="fas fa-search search-icon"></i>
                <input type="search" id="page-search" placeholder="{{ t.search_placeholder }}">
            </div>
        </div>

        <div class="settings-grid">
            
            <!-- Column 1: Navigation Tabs -->
            <aside class="settings-tabs">
                <button class="tab-item active" data-tab="general">
                    <i class="fas fa-sliders-h"></i> {{ t.settings_general_profile }}
                </button>
                <button class="tab-item" data-tab="security">
                    <i class="fas fa-shield-alt"></i> {{ t.settings_security_rbac }}
                </button>
                <button class="tab-item" data-tab="integrations">
                    <i class="fas fa-plug"></i> {{ t.settings_integrations }}
                </button>
                <button class="tab-item" data-tab="ai-governance">
                    <i class="fas fa-brain"></i> {{ t.settings_ai_governance }}
                </button>
                <button class="tab-item" data-tab="notifications">
                    <i class="fas fa-bell"></i> {{ t.settings_notifications }}
                </button>
            </aside>

            <!-- Column 2: Tab Content -->
            <main class="settings-content">
                
                <!-- 1. General & Profile Tab -->
                <div class="tab-pane active" id="pane-general">
                    <h2 class="pane-title">{{ t.settings_general_app_settings }}</h2>
                    
                    <section class="setting-section">
                        <h3>{{ t.settings_display_preferences }}</h3>

                        <div class="setting-group">
                            <label for="language-select">{{ t.settings_language }}</label>
                            <select id="language-select">
                                <option value="en"{% if current_lang == 'en' %} selected{% endif %}>
                                    {{ t.settings_language_en }}
                                </option>
                                <option value="ar"{% if current_lang == 'ar' %} selected{% endif %}>
                                    {{ t.settings_language_ar }}
                                </option>
                                <option value="fr"{% if current_lang == 'fr' %} selected{% endif %}>
                                    {{ t.settings_language_fr }}
                                </option>
                            </select>
                        </div>
                    </section>
                    
                    <section class="setting-section">
                        <h3>{{ t.settings_account_actions }}</h3>
                        <div class="setting-group">
                            <p>{{ t.current_email }}: <span id="user-email">{{ current_user_email }}</span></p>
                        </div>
                        <div class="setting-group">
                            <p>{{ t.current_role }}: <span id="current-role">{{ current_user_role }}</span></p>
                        </div>
                        <div class="setting-group">
                            <button id="update-profile-btn" class="btn btn-primary">
                                {{ t.settings_update_profile }}
                            </button>
                            <button id="delete-account-btn" class="btn btn-danger">
                                <i class="fas fa-trash-alt"></i> {{ t.settings_delete_account }}
                            </button>
                        </div>
                    </section>
                </div>

                <!-- 2. Security & RBAC Tab -->
                <div class="tab-pane" id="pane-security">
                    <h2 class="pane-title">{{ t.settings_security_role_management_title }}</h2>
                    
                    <section class="setting-section">
                        <h3>{{ t.settings_authentication }}</h3>
                        <div class="setting-group flex-justify">
                            <label>{{ t.settings_2fa_label }}</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="2fa-toggle" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </section>
                    
                    <section class="setting-section" id="rbac-management-section">
                        <h3>{{ t.settings_rbac_fr201 }}</h3>
                        <div class="setting-group">
                            <label for="manage-user-select">{{ t.settings_manage_user_permissions }}</label>
                            <select id="manage-user-select" class="full-width-input">
                                <option value="1">{{ t.settings_sample_user_alice }}</option>
                                <option value="2">{{ t.settings_sample_user_bob }}</option>
                            </select>
                        </div>
                        <div class="setting-group">
                            <label for="current-role">{{ t.settings_current_role_label }}</label>
                            <span id="current-role" class="status-badge status-active">
                                {{ t.settings_role_project_manager }}
                            </span>
                        </div>
                        
                        <div class="setting-group permission-grid">
                            <label class="grid-header">{{ t.settings_permission_header }}</label>
                            <label class="grid-header">{{ t.settings_status_header }}</label>
                            
                            <!-- Permission Item 1 -->
                            <span class="permission-name">{{ t.settings_permission_manage_budget_fr403 }}</span>
                            <label class="toggle-switch">
                                <input type="checkbox" data-permission="manage_budget" checked>
                                <span class="slider round"></span>
                            </label>

                            <!-- Permission Item 2 -->
                            <span class="permission-name">{{ t.settings_permission_create_projects_fr101 }}</span>
                            <label class="toggle-switch">
                                <input type="checkbox" data-permission="create_project">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <button id="save-rbac-btn" class="btn btn-primary mt-md">
                            {{ t.settings_save_permissions }}
                        </button>
                    </section>
                </div>

                <!-- 3. Integrations Tab -->
                <div class="tab-pane" id="pane-integrations">
                    <h2 class="pane-title">{{ t.settings_external_tool_connections }}</h2>
                    
                    <section class="setting-section integration-item">
                        <div class="integration-info">
                            <i class="fab fa-github"></i>
                            <h3>{{ t.settings_github }}</h3>
                            <span class="status-indicator status-connected">
                                {{ t.settings_status_connected }}
                            </span>
                        </div>
                        <button class="btn btn-secondary disconnect-btn" data-integration="github">
                            {{ t.settings_disconnect }}
                        </button>
                    </section>
                    
                    <section class="setting-section integration-item">
                        <div class="integration-info">
                            <i class="fab fa-slack"></i>
                            <h3>{{ t.settings_slack_notifications }}</h3>
                            <span class="status-indicator status-connected">
                                {{ t.settings_status_connected }}
                            </span>
                        </div>
                        <button class="btn btn-secondary disconnect-btn" data-integration="slack">
                            {{ t.settings_disconnect }}
                        </button>
                    </section>
                    
                    <section class="setting-section integration-item">
                        <div class="integration-info">
                            <i class="fab fa-google-drive"></i>
                            <h3>{{ t.settings_google_drive_audit_files }}</h3>
                            <span class="status-indicator status-disconnected">
                                {{ t.settings_status_disconnected }}
                            </span>
                        </div>
                        <button class="btn btn-primary connect-btn" data-integration="gdrive">
                            {{ t.settings_connect }}
                        </button>
                    </section>
                </div>

                <!-- 4. AI Governance Tab -->
                <div class="tab-pane" id="pane-ai-governance">
                    <h2 class="pane-title">{{ t.settings_ai_model_governance_fr508 }}</h2>
                    
                    <section class="setting-section">
                        <h3>{{ t.settings_model_information }}</h3>
                        <p>
                            <strong>{{ t.settings_active_model_version }}</strong>
                            <span id="model-version">v2.1.4 ({{ t.settings_status_active }})</span>
                        </p>
                        <p>
                            <strong>{{ t.settings_last_training_date }}</strong>
                            2025-11-28
                        </p>
                    </section>
                    
                    <section class="setting-section">
                        <h3>{{ t.settings_ai_feature_controls }}</h3>
                        <div class="setting-group flex-justify">
                            <label>{{ t.settings_enable_predictive_risk_scores_fr203 }}</label>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="setting-group flex-justify">
                            <label>{{ t.settings_enable_sentiment_analysis_fr503 }}</label>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </section>
                    
                    <section class="setting-section">
                        <h3>{{ t.settings_audit_compliance_fr508 }}</h3>
                        <p>{{ t.settings_ai_decisions_logged }}</p>
                        <button class="btn btn-secondary mt-md">
                            <i class="fas fa-file-export"></i> {{ t.settings_export_ai_audit_log }}
                        </button>
                    </section>
                </div>

                <!-- 5. Notifications Tab -->
                <div class="tab-pane" id="pane-notifications">
                    <h2 class="pane-title">{{ t.settings_notification_channels }}</h2>
                    
                    <section class="setting-section">
                        <h3>{{ t.settings_email_preferences }}</h3>
                        <div class="setting-group flex-justify">
                            <label>{{ t.settings_receive_email_p1_tasks }}</label>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </section>
                    
                    <section class="setting-section">
                        <h3>{{ t.settings_slack_configuration_linked }}</h3>
                        <p>{{ t.settings_slack_alerts_channel }}</p>
                        <div class="setting-group flex-justify">
                            <label>{{ t.settings_receive_alerts_swarm_assignment_fr202 }}</label>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </section>
                </div>
            </main>
        </div>
    </div>
{% endblock content %}

{% block extra_js %}
    <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
{% endblock extra_js %}
