{% extends "base.html" %}

{% block title %}{{ t.settings_title }} - AIPMS{% endblock title %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">
{% endblock extra_css %}

{% block content %}
    <div class="settings-container card" data-user-id="{{ user_id or 2 }}">
        <h1 class="page-title"><i class="fas fa-cog"></i> {{ t.settings_title }}</h1>

        <div class="settings-grid">
            
            <!-- Column 1: Navigation Tabs -->
            <aside class="settings-tabs">
                <button class="tab-item active" data-tab="general"><i class="fas fa-sliders-h"></i> {{ t.general }}</button>
                <button class="tab-item" data-tab="security"><i class="fas fa-shield-alt"></i> {{ t.security }}</button>
                <button class="tab-item" data-tab="integrations"><i class="fas fa-plug"></i> {{ t.integrations }}</button>
                <button class="tab-item" data-tab="ai-governance"><i class="fas fa-brain"></i> {{ t.ai_governance }}</button>
                <button class="tab-item" data-tab="notifications"><i class="fas fa-bell"></i> {{ t.notifications }}</button>
            </aside>

            <!-- Column 2: Tab Content -->
            <main class="settings-content">
                
                <!-- 1. General & Profile Tab -->
                <div class="tab-pane active" id="pane-general">
                    <h2 class="pane-title">{{ t.general_app_settings }}</h2>
                    
                    <section class="setting-section">
                        <h3>{{ t.display_preferences }}</h3>

                        <div class="setting-group">
                            <label for="language-select">{{ t.language }}</label>
                            <select id="language-select">
                                <option value="en" {% if current_lang == 'en' %}selected{% endif %}>English (US)</option>
                                <option value="ar" {% if current_lang == 'ar' %}selected{% endif %}>Arabic (AR)</option>
                            </select>
                        </div>
                    </section>
                    
                    <section class="setting-section">
                        <h3>{{ t.account_actions }}</h3>
                        <div class="setting-group">
                            <p>{{ t.current_email }}: <span id="user-email">{{ current_user_email }}</span></p>
                        </div>
                        <div class="setting-group">
                            <p>{{ t.current_role }}: <span id="current-role">{{ current_user_role }}</span></p>
                        </div>
                        <div class="setting-group">
                            <button id="update-profile-btn" class="btn btn-primary">{{ t.update_profile }}</button>
                            <button id="delete-account-btn" class="btn btn-danger"><i class="fas fa-trash-alt"></i> {{ t.delete_account }}</button>
                        </div>
                    </section>
                </div>

                <!-- 2. Security & RBAC Tab -->
                <div class="tab-pane" id="pane-security">
                    <h2 class="pane-title">{{ t.security_role_mgmt }}</h2>
                    
                    <section class="setting-section">
                        <h3>{{ t.authentication }}</h3>
                        <div class="setting-group flex-justify">
                            <label>{{ t.two_factor_auth }}</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="2fa-toggle" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </section>
                    
                    <section class="setting-section" id="rbac-management-section">
                        <h3>{{ t.rbac }}</h3>
                        <div class="setting-group">
                            <label for="manage-user-select">{{ t.manage_user_permissions }}</label>
                            <select id="manage-user-select" class="full-width-input">
                                <option value="1">Alice J. (Team Member)</option>
                                <option value="2">Bob S. (Project Manager)</option>
                            </select>
                        </div>
                        <div class="setting-group">
                            <label for="current-role">{{ t.current_role }}:</label>
                            <span id="current-role" class="status-badge status-active">Project Manager</span>
                        </div>
                        
                        <div class="setting-group permission-grid">
                            <label class="grid-header">{{ t.permission }}</label>
                            <label class="grid-header">{{ t.status }}</label>
                            
                            <!-- Permission Item 1 -->
                            <span class="permission-name">{{ t.manage_budget }}</span>
                            <label class="toggle-switch">
                                <input type="checkbox" data-permission="manage_budget" checked>
                                <span class="slider round"></span>
                            </label>

                            <!-- Permission Item 2 -->
                            <span class="permission-name">{{ t.create_projects }}</span>
                            <label class="toggle-switch">
                                <input type="checkbox" data-permission="create_project">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <button id="save-rbac-btn" class="btn btn-primary mt-md">{{ t.save_permissions }}</button>
                    </section>
                </div>

                <!-- 3. Integrations Tab -->
                <div class="tab-pane" id="pane-integrations">
                    <h2 class="pane-title">{{ t.external_tools }}</h2>
                    
                    <section class="setting-section integration-item">
                        <div class="integration-info">
                            <i class="fab fa-github"></i> <h3>GitHub</h3>
                            <span class="status-indicator status-connected">{{ t.connected }}</span>
                        </div>
                        <button class="btn btn-secondary disconnect-btn" data-integration="github">{{ t.disconnect }}</button>
                    </section>
                    
                    <section class="setting-section integration-item">
                        <div class="integration-info">
                            <i class="fab fa-slack"></i> <h3>Slack Notifications</h3>
                            <span class="status-indicator status-connected">{{ t.connected }}</span>
                        </div>
                        <button class="btn btn-secondary disconnect-btn" data-integration="slack">{{ t.disconnect }}</button>
                    </section>
                    
                    <section class="setting-section integration-item">
                        <div class="integration-info">
                            <i class="fab fa-google-drive"></i> <h3>Google Drive (Audit/Files)</h3>
                            <span class="status-indicator status-disconnected">{{ t.disconnected }}</span>
                        </div>
                        <button class="btn btn-primary connect-btn" data-integration="gdrive">{{ t.connect }}</button>
                    </section>
                </div>

                <!-- 4. AI Governance Tab -->
                <div class="tab-pane" id="pane-ai-governance">
                    <h2 class="pane-title">{{ t.ai_model_governance }}</h2>
                    
                    <section class="setting-section">
                        <h3>{{ t.model_information }}</h3>
                        <p><strong>{{ t.active_model_version }}:</strong> <span id="model-version">v2.1.4 (Active)</span></p>
                        <p><strong>{{ t.last_training_date }}:</strong> 2025-11-28</p>
                    </section>
                    
                    <section class="setting-section">
                        <h3>{{ t.ai_feature_controls }}</h3>
                        <div class="setting-group flex-justify">
                            <label>{{ t.enable_predictive_risk }}</label>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="setting-group flex-justify">
                            <label>{{ t.enable_sentiment_analysis }}</label>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </section>
                    
                    <section class="setting-section">
                        <h3>{{ t.audit_compliance }}</h3>
                        <p>{{ t.ai_decisions_logged }}</p>
                        <button class="btn btn-secondary mt-md"><i class="fas fa-file-export"></i> {{ t.export_audit_log }}</button>
                    </section>
                </div>

                <!-- 5. Notifications Tab -->
                <div class="tab-pane" id="pane-notifications">
                    <h2 class="pane-title">{{ t.notification_channels }}</h2>
                    
                    <section class="setting-section">
                        <h3>{{ t.email_preferences }}</h3>
                        <div class="setting-group flex-justify">
                            <label>{{ t.receive_email_alerts }}</label>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </section>
                    
                    <section class="setting-section">
                        <h3>{{ t.slack_configuration }}</h3>
                        <p>{{ t.alerts_sent_to }} **#backend-devs** on task status change.</p>
                        <div class="setting-group flex-justify">
                            <label>{{ t.receive_swarm_alerts }}</label>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </section>
                </div>
            </main>
        </div>
    </div>
{% endblock content %}

{% block extra_js %}
    <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
{% endblock extra_js %}