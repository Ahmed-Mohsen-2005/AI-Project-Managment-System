{% extends "base.html" %}

{% block title %}Project Analytics - AIPMS{% endblock title %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock extra_css %}

{% block content %}
    <!-- Search Bar -->
    <div style="margin-bottom: 20px;">
        <div class="search-bar-container">
            <i class="fas fa-search search-icon"></i>
            <input type="search" id="page-search" placeholder="{{ t.search_placeholder }}">
        </div>
    </div>
    
    <div class="project-dashboard-container">
        
        <!-- Dashboard Header (Includes Project Selector) -->
        <header class="dashboard-header">
            <h1 class="page-title"><i class="fas fa-chart-bar"></i> {{ t.project_analytics }}</h1>
            <div class="header-controls">
                <!-- Project Selector Dropdown -->
                <div class="control-group">
                    <label for="project-selector">{{ t.viewing_project }}</label>
                    <select id="project-selector" class="filter-select">
                        <option value="">{{ t.loading }}</option>
                    </select>
                </div>
                <span class="status-badge status-active" id="project-status">{{ t.active_status }}</span>
            </div>
        </header>

        <!-- 1. Top Metrics Summary - Individual Cards -->
        <div class="metrics-grid">
            <!-- Metric Card 1: Velocity -->
            <div class="card metric-card">
                <div class="metric-icon-wrapper" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <i class="fas fa-tachometer-alt"></i>
                </div>
                <div class="metric-content">
                    <p class="metric-value" id="current-velocity">--</p>
                    <p class="metric-label">{{ t.avg_velocity_3 }}</p>
                </div>
            </div>

            <!-- Metric Card 2: Risk Index -->
            <div class="card metric-card">
                <div class="metric-icon-wrapper" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="metric-content">
                    <p class="metric-value" id="risk-index">--</p>
                    <p class="metric-label">{{ t.ai_risk_index }}</p>
                </div>
            </div>

            <!-- Metric Card 3: Tasks Remaining -->
            <div class="card metric-card">
                <div class="metric-icon-wrapper" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <i class="fas fa-tasks"></i>
                </div>
                <div class="metric-content">
                    <p class="metric-value" id="tasks-remaining">--</p>
                    <p class="metric-label">{{ t.tasks_remaining }}</p>
                </div>
            </div>

            <!-- Metric Card 4: Budget Forecast -->
            <div class="card metric-card">
                <div class="metric-icon-wrapper" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="metric-content">
                    <p class="metric-value" id="budget-forecast">--</p>
                    <p class="metric-label">{{ t.budget_forecast }}</p>
                </div>
            </div>
        </div>

        <!-- 2. Main Content Grid (Charts and Activity) -->
        <div class="main-content-grid">

            <!-- Widget 1: Burndown Chart (Key Performance Indicator) -->
            <div class="card chart-widget" style="grid-column: 1 / -1;">
                <h2 class="widget-title"><i class="fas fa-chart-area"></i> Sprint Burndown (<span id="sprint-name">Active Sprint</span>)</h2>
                <div id="burndown-chart" class="chart-container">
                    <canvas id="burndown-canvas"></canvas>
                </div>
                <div id="chart-no-data" class="chart-no-data" style="display: none;">
                    <i class="fas fa-chart-line"></i>
                    <p>No sprint data available. Create a sprint with tasks to see the burndown chart.</p>
                </div>
            </div>

            <!-- Widget 2: Recent Project Activity -->
            <div class="card activity-widget" style="grid-column: 1 / -1;">
                <h2 class="widget-title"><i class="fas fa-history"></i> Recent Project Activity</h2>
                <ul id="recent-activity" class="activity-list scrollable-list">
                    <!-- Activities loaded by JS -->
                </ul>
                <a href="/repositories" class="view-link">{{ t.view_full_traceability_log }} &rarr;</a>
            </div>

        </div>
    </div>
{% endblock content %}

{% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock extra_js %}