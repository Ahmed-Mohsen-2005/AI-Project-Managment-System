{% extends "base.html" %}

{% block title %}Profile - AIPMS{% endblock title %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
{% endblock extra_css %}

{% block content %}
    <div class="profile-container">
        <!-- Search Bar -->
        <div style="margin-bottom: 20px;">
            <div class="search-bar-container">
                <i class="fas fa-search search-icon"></i>
                <input type="search" id="page-search" placeholder="{{ t.search_placeholder }}">
            </div>
        </div>
        
        <!-- Profile Header Card -->
        <div class="card profile-header-card">
            <div class="profile-info-main">
                {% set initials = current_user_name[0]|upper if current_user_name else 'U' %}
                <img src="https://placehold.co/80x80/4a90e2/ffffff?text={{ initials }}" alt="User Avatar" class="profile-avatar-large" id="profile-avatar">
                <div class="profile-text-details">
                    <h1 class="page-title" id="user-name">{{ current_user_name }}</h1>
                    <p class="user-role" id="user-role">Loading...</p>
                    <p class="user-email" id="user-email">{{ current_user_email }}</p>
                </div>
            </div>
            <div class="profile-actions">
                <button id="edit-profile-btn" class="btn btn-secondary"><i class="fas fa-edit"></i> {{ t.edit_profile }}</button>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="profile-content-grid">
            
            <!-- Column 1: AI Performance Metrics & Stats -->
            <div class="card stats-widget">
                <h2 class="widget-title"><i class="fas fa-chart-bar"></i> {{ t.performance_summary }}</h2>
                <div class="stats-grid">
                    
                    <div class="stat-item">
                        <p class="stat-value text-primary" id="user-velocity">100%</p>
                        <p class="stat-label">{{ t.avg_sprint_velocity }}</p>
                    </div>
                    <div class="stat-item">
                        <p class="stat-value text-warning" id="task-rejection">5%</p>
                        <p class="stat-label">{{ t.task_rejection_rate }}</p>
                    </div>
                    <div class="stat-item">
                        <p class="stat-value text-danger" id="risk-exposure">22%</p>
                        <p class="stat-label">AI Risk Exposure</p>
                    </div>
                    <div class="stat-item">
                        <p class="stat-value text-success" id="tasks-completed">85</p>
                        <p class="stat-label">Tasks Completed (YTD)</p>
                    </div>
                </div>
            </div>

            <!-- Column 2: Skill Management (FR-301) -->
            <div class="card skills-widget">
                <h2 class="widget-title"><i class="fas fa-tools"></i> Skill Set Management</h2>
                <div id="skills-list" class="skills-list">
                    <!-- Skills will be loaded and displayed here -->
                </div>
                
                <div class="skill-input-group">
                    <input type="text" id="new-skill-input" placeholder="e.g., Python, SQL Server, Vue.js">
                    <select id="skill-level-select">
                        <option value="3">Expert</option>
                        <option value="2">Proficient</option>
                        <option value="1">Familiar</option>
                    </select>
                    <button id="add-skill-btn" class="btn btn-primary btn-sm"><i class="fas fa-plus"></i> Add</button>
                </div>
            </div>

            <!-- Column 3: Recent Activity Log -->
            <div class="card activity-widget full-span">
                <h2 class="widget-title"><i class="fas fa-history"></i> Recent Activity Log</h2>
                <ul id="activity-log" class="activity-log scrollable-list">
                    <!-- Activity entries loaded by JS -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-edit"></i> Edit Profile</h3>
                <button id="close-edit-modal" class="icon-btn"><i class="fas fa-times"></i></button>
            </div>
            <form id="edit-profile-form">
                <div class="form-group">
                    <label for="edit-name"><i class="fas fa-user"></i> Full Name <span class="required">*</span></label>
                    <input type="text" id="edit-name" name="name" placeholder="Enter your full name" required>
                </div>
                <div class="form-group">
                    <label for="edit-email"><i class="fas fa-envelope"></i> Email <span class="required">*</span></label>
                    <input type="email" id="edit-email" name="email" placeholder="Enter your email address" required>
                </div>
                <div class="form-group">
                    <label for="edit-role"><i class="fas fa-briefcase"></i> Role <span class="required">*</span></label>
                    <select id="edit-role" name="role" required>
                        <option value="admin">Admin</option>
                        <option value="manager">Manager</option>
                        <option value="user">User</option>
                        <option value="guest">Guest</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" id="cancel-edit-btn" class="btn btn-secondary"><i class="fas fa-times"></i> Cancel</button>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Changes</button>
                </div>
            </form>
        </div>
    </div>
{% endblock content %}

{% block extra_js %}
    <script src="{{ url_for('static', filename='js/profile.js') }}"></script>
{% endblock extra_js %}